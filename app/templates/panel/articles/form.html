{% extends "panel/base.html" %}

{% block title %}{{ 'Edytuj' if article else 'Nowy' }} artykuł{% endblock %}

{% block head %}
<link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
    <h2 class="text-2xl font-bold text-gray-800">
        {% if article %}Edytuj artykuł{% else %}Nowy artykuł{% endif %}
    </h2>
    <a href="/panel/articles" class="text-sm text-gray-500 hover:text-gray-700">&larr; Powrót do listy</a>
</div>

<form method="post"
      action="{% if article %}/panel/articles/{{ article.id }}{% else %}/panel/articles{% endif %}"
      class="space-y-6">

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main column -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Title -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Tytuł</label>
                <input type="text" id="title" name="title" required
                       value="{{ article.title if article else '' }}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-lg">
            </div>

            <!-- Content -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <label for="content_md" class="block text-sm font-medium text-gray-700 mb-1">Treść (Markdown)</label>
                <textarea id="content_md" name="content_md" rows="20">{{ article.content_md if article else '' }}</textarea>
            </div>

            <!-- Excerpt -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <label for="excerpt" class="block text-sm font-medium text-gray-700 mb-1">Zajawka</label>
                <textarea id="excerpt" name="excerpt" rows="3"
                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                          placeholder="Krótki opis artykułu (wyświetlany na liście)">{{ article.excerpt if article else '' }}</textarea>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Publish -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                <select id="status" name="status"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    <option value="draft" {% if not article or article.status.value == 'draft' %}selected{% endif %}>Szkic</option>
                    <option value="published" {% if article and article.status.value == 'published' %}selected{% endif %}>Opublikowany</option>
                </select>

                <button type="submit"
                        class="w-full mt-4 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition-colors font-medium">
                    {% if article %}Zapisz zmiany{% else %}Utwórz artykuł{% endif %}
                </button>
            </div>

            <!-- Category -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <label for="category_id" class="block text-sm font-medium text-gray-700 mb-1">Kategoria</label>
                <select id="category_id" name="category_id"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    <option value="">— Brak —</option>
                    {% for cat in categories %}
                    <option value="{{ cat.id }}"
                        {% if article and article.category_id == cat.id %}selected{% endif %}>
                        {{ cat.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Tags -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <p class="block text-sm font-medium text-gray-700 mb-2">Tagi</p>
                <div class="space-y-1 max-h-48 overflow-y-auto">
                    {% for tag in tags %}
                    <label class="flex items-center gap-2 text-sm text-gray-700 cursor-pointer">
                        <input type="checkbox" name="tag_ids" value="{{ tag.id }}"
                               {% if article and tag in article.tags %}checked{% endif %}
                               class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                        {{ tag.name }}
                    </label>
                    {% endfor %}
                </div>
            </div>

            <!-- Featured image -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <label for="featured_image" class="block text-sm font-medium text-gray-700 mb-1">Obrazek wyróżniający (URL)</label>
                <input type="text" id="featured_image" name="featured_image"
                       value="{{ article.featured_image if article and article.featured_image else '' }}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm"
                       placeholder="/static/uploads/...">
            </div>

            <!-- SEO -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <p class="block text-sm font-medium text-gray-700 mb-3">SEO</p>
                <div class="space-y-3">
                    <div>
                        <label for="meta_title" class="block text-xs text-gray-500 mb-1">Meta title</label>
                        <input type="text" id="meta_title" name="meta_title"
                               value="{{ article.meta_title if article and article.meta_title else '' }}"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                               placeholder="Pozostaw puste = tytuł artykułu">
                    </div>
                    <div>
                        <label for="meta_description" class="block text-xs text-gray-500 mb-1">Meta description</label>
                        <textarea id="meta_description" name="meta_description" rows="2"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                  placeholder="Pozostaw puste = zajawka">{{ article.meta_description if article and article.meta_description else '' }}</textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
<script>
    const easyMDE = new EasyMDE({
        element: document.getElementById('content_md'),
        spellChecker: false,
        autosave: { enabled: false },
        status: ['lines', 'words'],
        minHeight: '400px',
        toolbar: [
            'bold', 'italic', 'heading', '|',
            'quote', 'unordered-list', 'ordered-list', '|',
            'link', 'image', 'table', '|',
            'preview', 'side-by-side', 'fullscreen', '|',
            'guide'
        ],
    });
</script>
{% endblock %}
