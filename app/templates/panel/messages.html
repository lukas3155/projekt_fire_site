{% extends "panel/base.html" %}

{% block title %}Wiadomości{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
    <h2 class="text-2xl font-bold text-gray-800">
        Wiadomości
        {% if unread %}
        <span class="text-sm font-normal text-gray-500">({{ unread }} nieprzeczytanych)</span>
        {% endif %}
    </h2>
</div>

{% if messages %}
<div class="space-y-4">
    {% for msg in messages %}
    <div class="bg-white rounded-lg shadow-sm p-6 {% if not msg.is_read %}border-l-4 border-fire-600{% endif %}">
        <div class="flex items-start justify-between gap-4">
            <div class="flex-1 min-w-0">
                <div class="flex items-center gap-3 mb-1">
                    <h3 class="font-semibold text-gray-800 {% if not msg.is_read %}text-fire-900{% endif %}">{{ msg.subject }}</h3>
                    {% if not msg.is_read %}
                    <span class="text-xs px-2 py-0.5 rounded-full bg-fire-600 text-white">Nowa</span>
                    {% endif %}
                </div>
                <p class="text-sm text-gray-500 mb-3">
                    Od: <span class="text-gray-700">{{ msg.name }}</span>
                    &lt;<span class="text-gray-700">{{ msg.email }}</span>&gt;
                    - {{ msg.created_at.strftime('%d.%m.%Y %H:%M') }}
                </p>
                <p class="text-gray-700 whitespace-pre-line">{{ msg.message }}</p>
            </div>
            <div class="flex items-center gap-2 flex-shrink-0">
                <form method="post" action="/panel/messages/{{ msg.id }}/read" class="inline">
                    {{ csrf_input(request) }}
                    <button type="submit" class="text-sm text-fire-700 hover:text-fire-900" title="{{ 'Oznacz jako nieprzeczytaną' if msg.is_read else 'Oznacz jako przeczytaną' }}">
                        {% if msg.is_read %}Cofnij{% else %}Przeczytana{% endif %}
                    </button>
                </form>
                <form method="post" action="/panel/messages/{{ msg.id }}/delete" class="inline"
                      onsubmit="return confirm('Na pewno usunąć wiadomość?')">
                    {{ csrf_input(request) }}
                    <button type="submit" class="text-sm text-red-600 hover:text-red-800">Usuń</button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="bg-white rounded-lg shadow-sm p-8 text-center">
    <p class="text-gray-500">Brak wiadomości.</p>
</div>
{% endif %}
{% endblock %}
